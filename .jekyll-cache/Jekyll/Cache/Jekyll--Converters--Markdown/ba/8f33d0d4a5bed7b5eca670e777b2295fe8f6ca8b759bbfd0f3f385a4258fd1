I"’<h1 id="zÃ¡kladnÃ­-prÃ¡ce-se-semafory">ZÃ¡kladnÃ­ prÃ¡ce se semafory</h1>

<h3 id="uÅ¾iteÄnÃ©-odkazy">UÅ¾iteÄnÃ© odkazy</h3>
<ul>
  <li><a href="https://docs.python.org/3/library/threading.html#semaphore-objects">Python Semaphore Objects</a></li>
  <li><a href="/assets/files/2020/lecture02.ipynb">ZdrojovÃ© kÃ³dy z cviÄenÃ­ formou notebooku</a></li>
</ul>

<h2 id="objekt-semaphore">Objekt <code class="language-plaintext highlighter-rouge">Semaphore</code></h2>
<p><code class="language-plaintext highlighter-rouge">Semaphore</code> je tÅ™Ã­da reprezentujÃ­cÃ­ synchronizaÄnÃ­ primitivum semafor. Semafor je pÅ™i vytvoÅ™enÃ­ nastaven na urÄitou hodnotu. Z teorie znÃ¡me dvÄ› funkce <code class="language-plaintext highlighter-rouge">P()</code> a <code class="language-plaintext highlighter-rouge">V()</code>, kterÃ© tuto hodnotu mÄ›nÃ­, v Python3 jsou tyto funkce pojmenovÃ¡ny <code class="language-plaintext highlighter-rouge">acquire()</code> a <code class="language-plaintext highlighter-rouge">release()</code>.</p>

<blockquote>
  <h1 id="Ãºkol">Ãškol</h1>
  <p>Pomoci semaforu mÅ¯Å¾eme elegantnÄ› implementovat takzvanÃ½ <code class="language-plaintext highlighter-rouge">mutex</code> a vyÅ™eÅ¡Ã­t tÃ­m problÃ©m z pÅ™edchozÃ­ hodiny. Upravte tedy sdÃ­lenÃ½ ÄÃ­taÄ tak, aby byla hodnota vÅ¾dy sprÃ¡vnÃ¡</p>
</blockquote>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threading</span>

<span class="k">def</span> <span class="nf">increment</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">counter</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100000</span><span class="p">):</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c1"># GlobÃ¡lnÃ­ counter        
</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>    

<span class="n">thread1</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">increment</span><span class="p">)</span>
<span class="n">thread2</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">increment</span><span class="p">)</span>

<span class="c1"># SpustÃ­me thread
</span><span class="n">thread1</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">thread2</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>

<span class="c1"># PoÄkÃ¡me na to aÅ¾ thread dobÄ›hne
</span><span class="n">thread1</span><span class="p">.</span><span class="n">join</span><span class="p">()</span>
<span class="n">thread2</span><span class="p">.</span><span class="n">join</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<blockquote>
  <h1 id="Ãºkol-1">Ãškol</h1>
  <p>NÃ¡sledujÃ­cÃ­ kÃ³d doplÅˆte o synchronizaci, tak aby byl <code class="language-plaintext highlighter-rouge">print()</code> provÃ¡dÄ›n ve sprÃ¡vnÃ©m poÅ™adÃ­. Synchronizace by nemÄ›la bÃ½t pÅ™Ã­liÅ¡ silnÃ¡, napÅ™Ã­klad nÃ¡s nezajÃ­mÃ¡ v jakÃ©m poÅ™adÃ­ bude vypsÃ¡no <code class="language-plaintext highlighter-rouge">Print before B</code> a <code class="language-plaintext highlighter-rouge">Print before A</code>.</p>
</blockquote>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">thread_a_function</span><span class="p">():</span>
    <span class="c1"># NÃ¡hodnÃ© ÄekÃ¡nÃ­, simuluje pomalejÅ¡Ã­/rychlejÅ¡Ã­ vlÃ¡kno
</span>    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="c1"># Obsah vlÃ¡kna
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"Print before B"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"A"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">thread_b_function</span><span class="p">():</span>
    <span class="c1"># NÃ¡hodnÃ© ÄekÃ¡nÃ­, simuluje pomalejÅ¡Ã­/rychlejÅ¡Ã­ vlÃ¡kno
</span>    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="c1"># Obsah vlÃ¡kna
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"Print before A"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"B"</span><span class="p">)</span>


<span class="n">thread_a</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">thread_a_function</span><span class="p">)</span>
<span class="n">thread_b</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">thread_b_function</span><span class="p">)</span>

<span class="n">thread_a</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">thread_b</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></figure>

:ET