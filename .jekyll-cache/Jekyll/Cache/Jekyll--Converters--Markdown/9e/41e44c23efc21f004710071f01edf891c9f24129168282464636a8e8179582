I"¸<h2 id="zÃ¡kladnÃ­-prÃ¡ce-s-vlÃ¡kny">ZÃ¡kladnÃ­ prÃ¡ce s vlÃ¡kny</h2>

<h4 id="uÅ¾iteÄnÃ©-odkazy">UÅ¾iteÄnÃ© odkazy</h4>
<ul>
  <li><a href="https://docs.python.org/3/library/threading.html">Python <code class="language-plaintext highlighter-rouge">threading</code> â€” Thread-based parallelism</a></li>
  <li><a href="/assets/files/2020/lecture01.ipynb">ZdrojovÃ© kÃ³dy z cviÄenÃ­ formou notebooku</a></li>
</ul>

<h3 id="objekt-thread">Objekt <code class="language-plaintext highlighter-rouge">Thread</code></h3>
<p><code class="language-plaintext highlighter-rouge">Thread</code> tÅ™Ã­da reprezentuje aktivitu bÄ›Å¾Ã­cÃ­ v separÃ¡tnÃ­m vlÃ¡knÄ›. Jsou zde dvÄ› moÅ¾nosti jak objektu <code class="language-plaintext highlighter-rouge">Thread</code> specifikovat aktivitu: pÅ™edÃ¡nÃ­ <code class="language-plaintext highlighter-rouge">callable object</code> do konstruktoru tÅ™Ã­dy <code class="language-plaintext highlighter-rouge">Thread</code>, nebo pÅ™epsÃ¡nÃ­ metody <code class="language-plaintext highlighter-rouge">run()</code>. Pro jednoduchost budeme pouÅ¾Ã­vat prvnÃ­ moÅ¾nost.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threading</span>

<span class="k">def</span> <span class="nf">example_activity</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Hello World"</span><span class="p">)</span>

<span class="n">example_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">example_activity</span><span class="p">)</span>

<span class="n">example_thread</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>PÅ™i vytvÃ¡Å™enÃ­ objektu <code class="language-plaintext highlighter-rouge">Thread</code> je rovnÄ›Å¾ moÅ¾nÃ© pÅ™edat aktivitÄ› argumenty.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threading</span>

<span class="k">def</span> <span class="nf">example_activity_with_args</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">f"Your number is </span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="n">example_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">example_activity_with_args</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,))</span>

<span class="n">example_thread</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="modifikace-globÃ¡lnÃ­-promÄ›nnÃ©-v-rÃ¡mci-vlÃ¡kna">Modifikace globÃ¡lnÃ­ promÄ›nnÃ© v rÃ¡mci vlÃ¡kna</h3>
<p>Pokud potÅ™ebujeme modifikovat promÄ›nnou v rÃ¡mci vlÃ¡kna musÃ­me pouÅ¾Ã­t klÃ­ÄovÃ© slovo <code class="language-plaintext highlighter-rouge">global</code>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threading</span>

<span class="n">text</span> <span class="o">=</span> <span class="s">'ahoj '</span>

<span class="k">def</span> <span class="nf">thread_function</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">text</span>

    <span class="n">text</span> <span class="o">+=</span> <span class="s">'svete'</span>

<span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">thread_function</span><span class="p">)</span>

<span class="n">thread</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">thread</span><span class="p">.</span><span class="n">join</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="problÃ©m-sdÃ­lenÃ©ho-ÄÃ­taÄe">ProblÃ©m sdÃ­lenÃ©ho ÄÃ­taÄe</h3>
<p>MÃ¡me dvÄ› vlÃ¡kna, kterÃ¡ inkrementujÃ­ sdÃ­lenÃ½ ÄÃ­taÄ. KaÅ¾dÃ© vlÃ¡kno mÃ¡ ÄÃ­taÄ postupnÄ› zvÃ½Å¡it o 100 000. OÄekÃ¡vanÃ¡ vÃ½slednÃ¡ hodnota je 200 000, proÄ tomu tak ne vÅ¾dy je?</p>

<div class="task">
<p><span>Ãškol</span><br />VytvoÅ™te dvÄ› vlÃ¡kna, kterÃ¡ se uspÃ­ na nÃ¡hodnÄ› dlouhou dobu (v rozsahu nÄ›kolika sekund) a vypÃ­Å¡Ã­ vÃ½stup na obrazovku.</p>
</div>

<div class="task">
<p><span>Ãškol</span><br />Naprogramujte Ãºlohu sdÃ­lenÃ©ho ÄÃ­taÄe a vyzkouÅ¡ejte zda opravdu nefunguje.</p>
</div>

<div class="task">
<p><span>Ãškol</span><br />MÄ›jme tÅ™i setÅ™Ã­zenÃ¡ pole <code>a</code>, <code>b</code>, <code>c</code> s celÃ½mi ÄÃ­sly. Je znÃ¡mo, Å¾e nÄ›kterÃ© ÄÃ­slo se vyskytuje v kaÅ¾dÃ©m poli. ParalelnÄ› nalÃ©znÄ›te nejmenÅ¡Ã­ index <code>i</code>, <code>j</code>, <code>k</code> pro kterÃ© platÃ­ <code>a[i] == b[j] == c[k]</code>, hodnoty vypiÅ¡te na obrazovku. Ãškol lze vyÅ™eÅ¡it tak, Å¾e nenÃ­ nutnÃ© pouÅ¾Ã­t synchronizaci.</p>
<p>
<strong>UkÃ¡zkovÃ½ vstup problÃ©mu</strong>

<code>
a = [3,4,5,6,7]<br />
b = [1,2,5,7,9]<br />
c = [3,4,6,7,9]<br />
</code>

<strong>UkÃ¡zkovÃ½ vÃ½stup</strong>

<code>
Thread 1 result: 7<br />
Thread 2 result: 7<br />
Thread 3 result: 7<br />
</code>
</p>
</div>
:ET